spec:
  inputs:
    stage:
      default: build
      description: Build the documentation
    dir:
      default: docs
      description: Relative directory where the Sphinx project is located
---

build sphinx website - $[[ inputs.dir ]]:
    stage: $[[ inputs.stage ]]
    image: docker-private.gesis.intra/rse/docker/images/sphinx-doc:2.3.0
    script:
        - cd $[[ inputs.dir ]]
        - make html
        - |
          if [ -d _build ]
          then
              echo Found _build
              mv _build/html ../public
          else
              echo Could NOT locate _build
          fi
        - |
          if [ -d build ]
          then
              echo Found build
              mv build/html ../public
          else
              echo Could NOT locate build
          fi
    artifacts:
        paths:
        - public

pages:
  stage: .post
  dependencies:
    - build sphinx website - $[[ inputs.dir ]]
  script:
    - echo Deploying documentation to GitLab Pages
  artifacts:
    paths:
      - public