spec:
  inputs:
    stage:
      default: build
      description: Build the documentation.
    job-name:
      default: build sphinx website
      description: Name of the job. This can be used for artifacts dependencies.
    dir:
      default: docs
      description: Relative directory where the Sphinx project is located.
    install_repo:
      type: boolean
      default: false
      description: Install current repo before build documentation. Required when using autodoc.
---

$[[ inputs.job-name ]]:
    stage: $[[ inputs.stage ]]
    image: docker-private.gesis.intra/rse/docker/images/sphinx-doc:2.5.0
    script:
        - |
          if [ "$[[ inputs.install_repo ]]" = "true" ]
          then
            pipx \
            inject \
            sphinx \
            .
          fi
        - cd $[[ inputs.dir ]]
        - make html
        - |
          if [ -d _build ]
          then
              echo Found _build
              mv _build/html ../public
          else
              echo Could NOT locate _build
          fi
        - |
          if [ -d build ]
          then
              echo Found build
              mv build/html ../public
          else
              echo Could NOT locate build
          fi
    artifacts:
        paths:
        - public